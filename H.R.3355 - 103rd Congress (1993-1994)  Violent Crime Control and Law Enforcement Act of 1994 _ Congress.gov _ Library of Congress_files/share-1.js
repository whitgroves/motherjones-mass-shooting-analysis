var LOCShare={Version:"1.9.15",Models:{},Views:{},Controllers:{},Copyright:"Copyrights Library of Congress 2009-2010"};(function($){$.scan(["LOCShare.Models","LOCShare.Views","LOCShare.Controllers"]);})(jQuery);(function($){$.env({automap:{":8082/":"dev.client",":8081/":"test.client",":8888/":"local.client","/":"prod.client"},prod:{client:{locshare:{root:"/share/",imageroot:"//cdn.loc.gov/share/images/"}}},test:{client:{locshare:{root:"/share/",imageroot:"//cdn.loc.gov:8081/share/images/"}}},dev:{client:{locshare:{root:"/share/",imageroot:"//cdn.loc.gov:8082/share/images/"}}},local:{client:{locshare:{root:"/share/",imageroot:"//localhost:8888/share/images/"}}},defaults:{locshare:{root:"//cdn.loc.gov/share",imageroot:"//cdn.loc.gov/share/images/",app_id:"Jl2ctw2m",request_type:"POST",request_datatype:"json",site_name:"loc.gov",subscribe_url:"/share/sites/library-of-congress/subscribe.php",default_subscribe_url:"/share/sites/library-of-congress/subscribe.php",link:window.location.href,title:window.document.title,object_type:"page",embed_type:null,embed_detail:null,embed_alt:null,download_links:null,download_link_label:null,thumbnail:{url:"",alt:"",width:"",height:""},img_alt_prefix:"Share to ",action:"share",message_max_chars:500,body_max_characters:508,field_defaults:{to_email:"Recipient's e-mail address",from_name:"Your Name"},align:"right",position:{horizontal:"auto",vertical:"auto"},show:{buttons:{print:true,subscribe:true,share:true,survey:true},tabs:{share:true,email:true,save:true},features:{link:true,bookmark:true,download:true}},toolbar:{print:{text:null,style:null},subscribe:{text:null,style:null},share:{text:null,style:null},survey:{text:null,style:null}},autoload:true,allow_plugins:false}}});})(jQuery);(function($){var q=document.location.search;if(q&&q.match("locshare=debug")){$.logging([{category:"LOCShare",level:"DEBUG"},{category:"Claypool",level:"INFO"},{category:"root",level:"WARN"}]);}else{if(q&&q.match("locshare=info")){$.logging([{category:"LOCShare",level:"INFO"},{category:"Claypool",level:"INFO"},{category:"root",level:"WARN"}]);}else{$.logging([{category:"LOCShare",level:"NONE"},{category:"root",level:"NONE"}]);}}})(jQuery);(function($){$.routes({"hijax:a":[{id:"#locshare-hash-routes",active:true,filter:'[href*="#locshare"]',stopPropagation:true,preventDefault:true,strategy:"first",hijaxMap:[{urls:"print$",controller:"#printController",action:"print"},{urls:"subscribe/close/|:id|$",controller:"#subscribeController",action:"close"},{urls:"subscribe$",controller:"#subscribeController"},{urls:"share/close/|:id|$",controller:"#shareController",action:"close"},{urls:"share/addfavorite/|:id|$",controller:"#shareController",action:"addFavorite"},{urls:"share/showlink/|:id|$",controller:"#shareController",action:"showLink"},{urls:"share/showembed/|:id|$",controller:"#shareController",action:"showEmbed"},{urls:"share/email/confirm/|:id|$",controller:"#shareController",action:"confirmEmail"},{urls:"share$",controller:"#shareController"},{urls:"survey/close/|:id|$",controller:"#surveyController",action:"close"},{urls:"survey$",controller:"#surveyController"}]}],"hijax:event":[{id:"#locshare-event-routes",stopPropagation:true,strategy:"all",hijaxMap:[{event:"locshare-start",controller:"#toolbarController",action:"monitor"},{event:"locshare-attach",controller:"#toolbarController",action:"setup"},{event:"locshare-register",controller:"#pluginController",action:"register"},{event:"locshare-unregister",controller:"#pluginController",action:"unregister"},{event:"locshare-open",controller:"#shareController",action:"closeAll"},{event:"locshare-open",controller:"#subscribeController",action:"closeAll"},{event:"locshare-open",controller:"#surveyController",action:"closeAll"}]}],"hijax:form":[{id:"#locshare-form-routes",active:true,filter:'[action*="#locshare"]',stopPropagation:true,preventDefault:true,hijaxMap:[{urls:"share/email/|:id|$",controller:"#shareController",action:"email"}]}]});})(jQuery);(function($){var log,pluginModel;$.filters([{id:"#LOCShareControllerBeforeFilter",target:"LOCShare.Controllers.*",before:"([a-z]*)",advice:function(event){log=log||$.logger("LOCShare.Filters");pluginModel=pluginModel||$.$("#pluginModel");var invocation=arguments[arguments.length-1];var target=invocation.target;var method=invocation.method;switch(target){case"LOCShare.Controllers.Toolbar":switch(method){case"setup":pluginModel.run("pre-"+method,{event:event});break;case"create":pluginModel.run("pre-toolbar",{event:event});break;}break;case"LOCShare.Controllers.Print":switch(method){case"print":pluginModel.run("pre-"+method,{event:event});break;}break;case"LOCShare.Controllers.Share":switch(method){case"handle":pluginModel.run("pre-share-open",{event:event});break;case"close":case"closeAll":pluginModel.run("pre-share-close",{event:event});break;}break;case"LOCShare.Controllers.Subscribe":switch(method){case"handle":pluginModel.run("pre-subscribe-open",{event:event});break;case"close":case"closeAll":pluginModel.run("pre-subscribe-close",{event:event});break;}break;}}},{id:"#LOCShareControllerAfterFilter",target:"LOCShare.Controllers.*",after:"([a-z]*)",advice:function(values,target,method){log=log||$.logger("LOCShare.Filters");pluginModel=pluginModel||$.$("#pluginModel");switch(target){case"LOCShare.Controllers.Toolbar":switch(method){case"setup":pluginModel.run("post-"+method,values);break;case"create":pluginModel.run("post-toolbar",values);break;}break;case"LOCShare.Controllers.Print":switch(method){case"print":pluginModel.run("post-"+method,values);break;}break;case"LOCShare.Controllers.Share":switch(method){case"handle":pluginModel.run("post-share-open",values);break;case"close":case"closeAll":pluginModel.run("post-share-close",values);break;}break;case"LOCShare.Controllers.Subscribe":switch(method){case"handle":pluginModel.run("post-subscribe-open",values);break;case"close":case"closeAll":pluginModel.run("post-subscribe-close",values);break;}break;}}}]);})(jQuery);(function($,$V){var log,template="            <div class='locshare-toolbar'>                <span class='locshare-print-button'>                    <a href='#locshare/print' accesskey='5'>                        Print                    </a>                </span>                <span class='locshare-subscribe-button'>                    <a href='#locshare/subscribe' accesskey='6'>                        Subscribe                    </a>                </span>                <span class='locshare-share-button'>                    <a href='#locshare/share' accesskey='7'>                        Share/Save                    </a>                </span>                <span class='locshare-survey-button'>                    <a href='#locshare/survey' accesskey='8'>                        Give Feedback                    </a>                </span>            </div>        ";var surveyHtml="        :-)    ";$V.Toolbar=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Views.Toolbar");};$.extend($V.Toolbar.prototype,{think:function(model){},update:function(model){var shareToolbar=$(template);$(shareToolbar).attr("id",model.id);switch(model.config.align){case"right":log.debug("aligning right");$(shareToolbar).addClass("right");break;case"left":log.debug("aligning left");$(shareToolbar).addClass("left");break;case"center":log.debug("aligning center");$(shareToolbar).addClass("center");break;}if(false==model.config.show.buttons.print){log.debug("supressing print button");$(".locshare-print-button",shareToolbar).remove();}else{if(null!==model.config.toolbar.print.text){$(".locshare-print-button > a",shareToolbar).html(model.config.toolbar.print.text);}if(null!==model.config.toolbar.print.style){$(".locshare-print-button",shareToolbar).addClass(model.config.toolbar.print.style);}}if(false==model.config.show.buttons.subscribe){log.debug("supressing subscribe button");$(".locshare-subscribe-button",shareToolbar).remove();}else{if(null!==model.config.toolbar.subscribe.text){$(".locshare-subscribe-button > a",shareToolbar).html(model.config.toolbar.subscribe.text);}if(null!==model.config.toolbar.subscribe.style){$(".locshare-subscribe-button",shareToolbar).addClass(model.config.toolbar.subscribe.style);}}if(false==model.config.show.buttons.share){log.debug("supressing share button");$(".locshare-share-button",shareToolbar).remove();}else{if(null!==model.config.toolbar.share.text){$(".locshare-share-button > a",shareToolbar).html(model.config.toolbar.share.text);}if(null!==model.config.toolbar.share.style){$(".locshare-share-button",shareToolbar).addClass(model.config.toolbar.share.style);}}this.populateSurveyUrlByHref(model.config);if(false==model.config.show.buttons.survey||model.config.survey_url==undefined||model.config.survey_url==""){log.debug("supressing survey button");$(".locshare-survey-button",shareToolbar).remove();}else{if(null!==model.config.toolbar.survey.text){$(".locshare-survey-button > a",shareToolbar).html(model.config.toolbar.survey.text);}if(null!==model.config.toolbar.survey.style){$(".locshare-survey-button",shareToolbar).addClass(model.config.toolbar.survey.style);}}$(model.target).replaceWith(shareToolbar);},populateSurveyUrlByHref:function(config){if(config.surveys){for(var partialUrl in config.surveys){if(window.location.href.indexOf(partialUrl)>-1){config.survey_url=config.surveys[partialUrl];}}}}});})(jQuery,LOCShare.Views);(function($,$V){var log,cache,subscribeModel,template="            <div class='locshare-dialog-inner'>                <div class='locshare-dialog-head'>                    <a href='#' class='locshare-dialog-close'>Close</a>                </div>                <div class='locshare-dialog-loading'></div>            </div>        ";$V.Subscribe=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Views.Subscribe");cache={};subscribeModel=$.$("#subscribeModel");};$.extend($V.Subscribe.prototype,{think:function(model){},update:function(model){var subscribeDialog,id;if(!(model&&model.id)){log.debug("closing all subscribe dialogs");for(id in cache){if($(cache[id]).dialog("isOpen")){$(cache[id]).dialog("close");}}}else{if(!(model.id in cache)){log.debug("creating new subscribe dialog for id %s",model.id);subscribeDialog=$(template);$(subscribeDialog).attr("id",model.id+"-subscribe-dialog");$("a.locshare-dialog-close",subscribeDialog).attr("href","#locshare/subscribe/close/"+model.id);$("span.locshare-dialog-title-site",subscribeDialog).html(model.options.site_name);log.debug("lazy loading content for subscribe dialog from %s",model.options.subscribe_url);subscribeModel.get({id:model.id,url:model.options.subscribe_url,fallback_url:model.options.default_subscribe_url,request_type:model.options.request_type,request_datatype:model.options.request_datatype},function(content){$("div.locshare-dialog-loading",subscribeDialog).replaceWith(content);});$(subscribeDialog).dialog({autoOpen:false,resizable:false,bgiframe:true,width:"510px",dialogClass:"locshare-dialog locshare-subscribe-arrow",close:function(){$("#"+model.id+' a[href*="locshare/subscribe"]').focus();}});cache[model.id]=subscribeDialog;}else{subscribeDialog=cache[model.id];}}if(model&&model.id){if($(subscribeDialog).dialog("isOpen")){log.debug("closing subscribe dialog for id %s",model.id);$(subscribeDialog).dialog("close");}else{log.debug("opening subscribe dialog for id %s",model.id);model.position.top=model.position.top-$(document).scrollTop();$(subscribeDialog).dialog("option","position",[model.position.left,model.position.top]);$(subscribeDialog).dialog("open");$(subscribeDialog).parents(".ui-dialog").appendTo("#"+model.id).focus();}}}});})(jQuery,LOCShare.Views);(function($,$V){var log,cache,fieldError="<div class='locshare-field-error locshare-message-error'></div>",template="        <div class='locshare-dialog-inner'>            <div class='locshare-dialog-head'>                <ul class='locshare-dialog-menu'>                    <li class='locshare-dialog-menu-item locshare-dialog-menu-item-share locshare-dialog-menu-item-active share-subtab'><a href='#'><span>SHARE</span></a></li>                    <li class='locshare-dialog-menu-item locshare-dialog-menu-item-email email-subtab'><a href='#'><span>E-MAIL</span></a></li>                    <li class='locshare-dialog-menu-item locshare-dialog-menu-item-save save-subtab'><a href='#'><span>SAVE</span></a></li>                </ul>                <a href='#' class='locshare-dialog-close'>Close</a>            </div>            <div class='locshare-share-tab'>                <div class='locshare-dialog-content'>                    <div class='locshare-share-tab-link-list e3x'>{                        $(options.urls).map(function(index, value){                            return {                                div:{                                    $class:(index!==0&&index%3==0)?'locshare-share-tab-item-clear':'',                                    a:{                                        $rel:id,                                        $href:this.url,                                        $target:'_blank',                                        $:[                                            this.name,                                            {img:{                                                $src:options.imageroot+this.icon,                                                $alt:options.img_alt_prefix+this.name                                            }}                                        ]                                    }                                }                            };                        }).x()                    }</div>                </div>                <div class='locshare-dialog-footer'>                    <a href='http://www.loc.gov/homepage/legal.html#privacy_policy'                       target='_blank' class='locshare-privacy'>Privacy Policy</a>                    <a href='http://www.loc.gov/global/disclaim.html'                       target='_blank' class='locshare-disclaimer'>Disclaimer</a>                </div>            </div>            <div class='locshare-email-tab'>                <div class='locshare-dialog-content'>                    <div class='locshare-email-tab-form-container'>                        <form name='locshare-share_form_email' class='locshare-email-tab-form' method='post' action='#locshare/share/email'>                            <div class='locshare-email-tab-input'>                            		<div>                                <div class='locshare-email-tab-input-4col '>                                    <label class='locshare-email-table-label  locshare-email-tab-label-from_name'><span class='locshare-form-field-required'>*</span> From</label>                                    <input  value='Your name' class='locshare-email-tab-form-field-defaults full-width' name='from_name' id='from_name' type='text'                                         class='locshare-email-tab-form-field-from_name locshare-email-tab-form-field-defaults' />                            		</div>                            				</div><div class='email-instruction-text'>&nbsp;</div></div>                            <div class='locshare-email-tab-input'>                                <label class='locshare-email-table-label locshare-email-tab-label-message'>                                    		<div><input type='text' readonly name='share-url' value='"+window.location.href+"' class='full-width'/></div>                                    				<div class='email-instruction-text'>Or, copy and paste this link into any email</div>                                    </label>                                    		<textarea style='display:none' name='page_title'>"+encodeURIComponent(document.title)+" </textarea>		</div>                                                        				<span class='locshare-form-field-required'>*</span> Required                            <div class='locshare-email-tab-input locshare-right'>                                <button class='locshare-button locshare-button-text'                                        value='Next'                                        name='locshare_email_submit'                                        type='submit'>                                    Next                                </button>                            </div>                            <div class='locshare-email-tab-message'>                                <p class=''></p>                            </div>                        </form>                    </div>                    <div class='locshare-email-tab-wait-container'>                        <div class='locshare-email-tab-wait-box'>                            Please wait...                        </div>                    </div>                    <div class='locshare-email-tab-confirm-container'>                        <div class='locshare-email-tab-confirm-box'>                            <p class='locshare-email-tab-confirm-message locshare-message-success'>                                Your message has been sent successfully.                            </p>                            <p class='locshare-email-tab-confirm-button'>                                <a href='#locshare/share/email/confirm/'>Continue</a>                            </p>                        </div>                    </div>                </div>                <div class='locshare-dialog-footer'>                    <a href='http://www.loc.gov/homepage/legal.html#privacy_policy'                       target='_blank' class='locshare-privacy'>Privacy Policy</a>                </div>            </div>            <div class='locshare-save-tab'>                <div class='locshare-dialog-content'>                    <div class='locshare-save-tab-links'>                        <h3>To link to or embed this content, copy and paste this into your Web site or blog.</h3>                        <div class='locshare-save-tab-link-list'>                            <span class='locshare-save-tab-link-list-first'>                                <a href='#locshare/share/showlink'>Link</a>                            </span>                            <span>                                <a href='#locshare/share/showembed'>Embed</a>                            </span>                        </div>                        <p class='locshare-save-tab-link-instruction'>                            Paste this code into your Website or blog.                        </p>                        <input type='text' name='locshare-save-tab-copy-box'                            class='locshare-save-tab-copy-box'                            value='Click on the links above to update this field.'>                    </div>                    <div class='locshare-save-tab-addfavorite'>                        <h3>Save to Favorites</h3>                        <p class='locshare-save-tab-save-box'>                            <em>Save to my Browser</em>                             <a href='#locshare/share/addfavorite'>Save</a>                        </p>                    </div>                    <div class='locshare-save-tab-downloads'>                        <h3>Download</h3>                        <div class='locshare-save-tab-downloads-scroll'>                            <div class='e3x'>                                {options.download_links?$(options.download_links).map(function(index, value){                                    return {                                        p:{                                            a:{                                                $href:value.link,                                                $target:'_blank',                                                $:value.label,                                                $rel:id                                            },                                            span:{                                                $class:'locshare-download-meta',                                                $:(value.meta!=undefined&&value.meta!='')?'('+value.meta+')':''                                            }                                        }                                    };                                }).x():''}                            </div>                        </div>                    </div>                </div>                <div class='locshare-dialog-footer'>                    <a href='http://www.loc.gov/homepage/legal.html#privacy_policy'                       target='_blank' class='locshare-privacy'>Privacy Policy</a>                </div>            </div>        </div>    ";$V.Share=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Views.Share");cache={};};$.extend($V.Share.prototype,{think:function(model){},update:function(model){var shareDialog,id;if(!(model&&model.id)){log.debug("closing all share dialogs");for(id in cache){if($(cache[id]).dialog("isOpen")){$(cache[id]).dialog("close");}}}else{if(!(model.id in cache)){log.debug("creating new share dialog for id %s",model.id);shareDialog=$($.e3x(template,model));$(shareDialog).attr("id",model.id+"-share-dialog");$("a.locshare-dialog-close",shareDialog).attr("href","#locshare/share/close/"+model.id);log.debug("rendering template");if(false==model.options.show.tabs.share){log.debug("supressing share tab");$("div.locshare-share-tab",shareDialog).remove();$("li.locshare-dialog-menu-item-share",shareDialog).remove();}else{$("div.locshare-share-tab",shareDialog).attr("id",model.id+"-share-tab");$("li.locshare-dialog-menu-item-share a",shareDialog).attr("href","#"+model.id+"-share-tab");}if(false==model.options.show.tabs.email){log.debug("supressing email tab");$("div.locshare-email-tab",shareDialog).remove();$("li.locshare-dialog-menu-item-email",shareDialog).remove();}else{$("div.locshare-email-tab",shareDialog).attr("id",model.id+"-email-tab");$("li.locshare-dialog-menu-item-email a",shareDialog).attr("href","#"+model.id+"-email-tab");$("form.locshare-email-tab-form",shareDialog).attr("action","#locshare/share/email/"+model.id);$("span.locshare-email-tab-field-message-remaining-chars",shareDialog).text(model.options.message_max_chars);$("input.locshare-email-tab-form-field-defaults",shareDialog).each(function(){$(this).attr("value",model.options.field_defaults[$(this).attr("name")]);});$('input[name="to_email"]',shareDialog).attr("id","to_email_"+model.id);$("label.locshare-email-tab-label-to_email",shareDialog).attr("for","to_email_"+model.id);$('input[name="from_name"]',shareDialog).attr("id","from_name_"+model.id);$("label.locshare-email-tab-label-from_name",shareDialog).attr("for","from_name_"+model.id);$('textarea[name="page_title"]',shareDialog).attr("id","page_title_"+model.id);$("label.locshare-email-tab-label-message",shareDialog).attr("for","message_"+model.id);$('input[name="send_copy"]',shareDialog).attr("id","send_copy_"+model.id);$("label.locshare-email-tab-label-send_copy",shareDialog).attr("for","send_copy_"+model.id);$("div.locshare-email-tab-message",shareDialog).hide();$("div.locshare-email-tab-confirm-container",shareDialog).hide();$("p.locshare-email-tab-confirm-button > a",shareDialog).attr("href","#locshare/share/email/confirm/"+model.id);$("button[name=locshare_email_submit] > img",shareDialog).attr("src",model.options.imageroot+"/btn-submit.png");$("div.locshare-email-tab-wait-container",shareDialog).hide();}if(false==model.options.show.tabs.save){log.debug("supressing save tab");$("div.locshare-save-tab",shareDialog).remove();$("li.locshare-dialog-menu-item-save",shareDialog).remove();}else{$("div.locshare-save-tab",shareDialog).attr("id",model.id+"-save-tab");$("li.locshare-dialog-menu-item-save a",shareDialog).attr("href","#"+model.id+"-save-tab");if(false==model.options.show.features.link){log.debug("suppressing link feature");$("div.locshare-save-tab-links",shareDialog).remove();}else{$("p.locshare-save-tab-link-instruction",shareDialog).hide();if(model.options.embed_type&&model.options.embed_detail){$("div.locshare-save-tab-link-list > span > a",shareDialog).each(function(){var href=$(this).attr("href");$(this).attr("href",href+"/"+model.id);});}else{$("div.locshare-save-tab-link-list",shareDialog).hide();$("input.locshare-save-tab-copy-box",shareDialog).attr("value",model.options.link);}}if(false==model.options.show.features.bookmark){log.debug("suppressing bookmark feature");$("div.locshare-save-tab-addfavorite",shareDialog).remove();}else{$("p.locshare-save-tab-save-box > a",shareDialog).attr("href","#locshare/share/addfavorite/"+model.id);}if(false==model.options.show.features.download){log.debug("suppressing download feature");$("div.locshare-save-tab-downloads",shareDialog).remove();}else{if(!($.isArray(model.options.download_links)&&model.options.download_links.length)){$("div.locshare-save-tab-downloads",shareDialog).hide();}}}$(shareDialog).dialog({autoOpen:false,resizable:false,bgiframe:true,width:"510px",dialogClass:"locshare-dialog locshare-share-arrow",close:function(){$("#"+model.id+' a[href*="locshare/share"]').focus();}});($(shareDialog)).tabs();cache[model.id]=shareDialog;}else{shareDialog=cache[model.id];}}if(model&&model.id){if($(shareDialog).dialog("isOpen")){log.debug("closing share dialog for id %s",model.id);$(shareDialog).dialog("close");}else{log.debug("opening share dialog for id %s",model.id);model.position.top-=$(document).scrollTop();$(shareDialog).dialog("option","position",[model.position.left,model.position.top]);$(shareDialog).dialog("open");$(shareDialog).parents(".ui-dialog").appendTo("#"+model.id).focus();}}if(window.loc_ux_tracking!=undefined){$(".locshare-print-button > a").bind("click",function(){$.$("#shareView").handleClick("[print button] - click");});$(".locshare-subscribe-button > a").bind("click",function(){$.$("#shareView").handleClick("[subscribe button] - click");});$(".locshare-share-button > a").bind("click",function(){$.$("#shareView").handleClick("[share/save button] - click");});$(".locshare-dialog-menu-item-email > a").bind("click",function(){$.$("#shareView").handleClick("[share/save button] - email tab click");});$(".locshare-dialog-menu-item-save > a").bind("click",function(){$.$("#shareView").handleClick("[share/save button] - save tab click");});}},handleClick:function(interaction){loc_ux_tracking.trackUserInterfaceAction($,"Share and Save Toolbar",interaction);},showLink:function(model){var shareDialog=cache[model.id];$("div.locshare-save-tab-link-list span",shareDialog).removeClass("locshare-selected");$(model.target).parent().addClass("locshare-selected");$("p.locshare-save-tab-link-instruction",shareDialog).hide();$("input.locshare-save-tab-copy-box",shareDialog).attr("value",model.options.link);},showEmbed:function(model){var shareDialog=cache[model.id],embedText;switch(model.options.embed_type){case"video":embedText='<script src="http://www.loc.gov/videoplayer.js?video='+model.options.embed_detail+'&other_options" type="text/javascript"><\/script><noscript>Embedded video from <a href="http://loc.gov">Library of Congress</a></noscript>';break;case"audio":embedText='<script src="http://www.loc.gov/audioplayer.js?audio='+model.options.embed_detail+'&other_options" type="text/javascript"><\/script><noscript>Embedded audio from <a href="http://loc.gov">Library of Congress</a></noscript>';break;case"image":if(model.options.embed_alt==null){model.options.embed_alt="Image shared from Library Of Congress";}embedText='<a href="'+model.options.link+'" target="_blank"><img src="'+model.options.embed_detail+'" alt="'+model.options.embed_alt+'" /></a>';break;default:embedText="Embed code is not available for this item.";break;}$("div.locshare-save-tab-link-list span",shareDialog).removeClass("locshare-selected");$(model.target).parent().addClass("locshare-selected");$("input.locshare-save-tab-copy-box",shareDialog).attr("value",embedText);},showEmailErrors:function(model){var shareDialog=cache[model.id],_this=this;log.debug("Showing email errors");$.each(model.errors,function(){var input=$('[name="'+this.field+'"]',shareDialog);if(!input.hasClass("locshare-error")){input.addClass("locshare-error");}var errorDiv=$(fieldError);$(errorDiv).text(this.message);input.parent().append(errorDiv);});$("div.locshare-email-tab-wait-container",shareDialog).hide();$("div.locshare-email-tab-form-container",shareDialog).show();},updateEmailStatus:function(model){var shareDialog=cache[model.id],form_container=$("div.locshare-email-tab-form-container",shareDialog),form_status=$("div.locshare-email-tab-message > p",shareDialog);$("div.locshare-email-tab-wait-container",shareDialog).hide();if(model.success){var confirm_container=$("div.locshare-email-tab-confirm-container",shareDialog);$("p.locshare-email-tab-confirm-message",shareDialog).text(model.text);form_status.text("");if(form_status.hasClass("locshare-message-error")){form_status.removeClass("locshare-message-error");}$('[name="to_email"]',form_container).attr("value",model.options.field_defaults.to_email);$('[name="from_name"]',form_container).attr("value",model.options.field_defaults.from_name);$('[name="send_copy"]',form_container).attr("checked",false);$("span.locshare-email-tab-field-message-remaining-chars",form_container).text(model.options.message_max_chars);form_container.hide();confirm_container.show();}else{if(model.text.indexOf("<html")>-1){log.error(model.text);model.text="An error occurred. Email not sent.";}form_status.text(model.text);if(form_status.hasClass("locshare-message-success")){form_status.removeClass("locshare-message-success");}form_status.addClass("locshare-message-error");$("div.locshare-email-tab-message",shareDialog).show();form_container.show();}},confirmEmail:function(model){var shareDialog=cache[model.id];$("div.locshare-email-tab-confirm-container",shareDialog).hide();$("div.locshare-email-tab-form-container",shareDialog).show();},waitEmail:function(model){var shareDialog=cache[model.id];log.debug("Email form waiting");$("div.locshare-email-tab-form-container input.locshare-error",shareDialog).each(function(){$(this).removeClass("locshare-error");});$("div.locshare-email-tab-form-container div.locshare-field-error",shareDialog).each(function(){$(this).remove();});}});})(jQuery,LOCShare.Views);(function($,$V){var log,cache,surveyModel,template="            <div class='locshare-dialog-inner'>                <div class='locshare-dialog-head'>                    <a href='#' class='locshare-dialog-close'>Close</a>                </div>                <div class='locshare-dialog-loading'></div>            </div>        ";$V.Survey=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Views.Survey");cache={};surveyModel=$.$("#surveyModel");};$.extend($V.Survey.prototype,{think:function(model){},update:function(model){var surveyDialog,id;if(!(model&&model.id)){log.debug("closing all survey dialogs");for(id in cache){if($(cache[id]).dialog("isOpen")){$(cache[id]).dialog("close");}}}else{if(!(model.id in cache)){log.debug("creating new survey dialog for id %s",model.id);surveyDialog=$($.e3x(template,model));$(surveyDialog).attr("id",model.id+"-survey-dialog");$("a.locshare-dialog-close",surveyDialog).attr("href","#locshare/survey/close/"+model.id);log.debug("lazy loading content for survey dialog from %s",model.options.survey_url);var survey_url=model.options.survey_url;var survey_param="survey_link=";var index=survey_url.indexOf(survey_param);if(index>-1){var index_of_encoding=survey_url.indexOf("%2F",index+survey_param.length);if(index_of_encoding==-1){survey_url=survey_url.substr(0,index+survey_param.length)+encodeURIComponent(survey_url.substr(index+survey_param.length));}}if(model.options.survey_datatype&&model.options.survey_datatype=="jsonp"){survey_url+="&survey_datatype=jsonp";}surveyModel.get({id:model.id,url:survey_url,request_type:model.options.request_type,survey_datatype:model.options.survey_datatype},function(content){$("div.locshare-dialog-loading",surveyDialog).replaceWith(content);});$(surveyDialog).dialog({autoOpen:false,resizable:false,bgiframe:true,width:"510px",dialogClass:"locshare-dialog locshare-survey-arrow",close:function(){$("#"+model.id+' a[href*="locshare/survey"]').focus();}});cache[model.id]=surveyDialog;}else{surveyDialog=cache[model.id];}}if(model&&model.id){if($(surveyDialog).dialog("isOpen")){log.debug("closing survey dialog for id %s",model.id);$(surveyDialog).dialog("close");}else{log.debug("opening survey dialog for id %s",model.id);model.position.top=model.position.top-$(document).scrollTop();$(surveyDialog).dialog("option","position",[model.position.left,model.position.top]);$(surveyDialog).dialog("open");}}}});})(jQuery,LOCShare.Views);(function($,$C){var log,pluginModel;$C.Plugin=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Controllers.Plugin");pluginModel=$.$("#pluginModel");};$.extend($C.Plugin.prototype,{register:function(event,config){log.info("Registering plugin for event '%s' with name '%s'",config.type,config.name);pluginModel.register(config.type,config.name,config.plugin);},unregister:function(event,config){log.info("Unregistering plugin for event '%s' with name '%s'",config.type,config.name);pluginModel.unregister(config.type,config.name);}});})(jQuery,LOCShare.Controllers);(function($,$C){var log,started=false,shareModel,pluginModel;$C.Toolbar=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Controllers.Toolbar");shareModel=$.$("#shareModel");pluginModel=$.$("#pluginModel");};$.extend($C.Toolbar.prototype,{monitor:function(event){if(false===started){$("div.locshare-this").livequery(function(){$(this).trigger("locshare-attach");});started=true;}},setup:function(event){var id=$(event.target).attr("id");log.debug("setting up loc share toolbar for id %s",id);var data=$("> code",event.target);shareModel.put(id,data.length?$(data).html():"{}");event.c("#toolbarController.create").render();return{event:event,config:shareModel.get(id)};},create:function(event){var id=$(event.target).attr("id");log.debug("creating loc share toolbar for id %s",id);var model={id:id,target:event.target,config:shareModel.get(id)};event.m(model).render();return{config:model};}});})(jQuery,LOCShare.Controllers);(function($,$C){var log,logModel,shareModel,pluginModel;$C.Subscribe=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Controllers.Subscribe");logModel=$.$("#logModel");shareModel=$.$("#shareModel");pluginModel=$.$("#pluginModel");};$.extend($C.Subscribe.prototype,{handle:function(event){var id=$(event.target).parents("div").attr("id"),config=shareModel.get(id),position=$(event.target).position(),configHpos=config.position.horizontal,configVpos=config.position.vertical;if(("left"==configHpos)||("right"!=configHpos&&position.left+511>$(document).width())){position.left=position.left-450;}position.top+=18;log.debug("subscribe clicked for id %s",id);$(document).trigger("locshare-open");logModel.post({root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,object_type:config.object_type,action:"view_subscribe",target:null,title:config.title,link:config.link,embed_type:null,embed_detail:null,download_link_label:null});var model={id:id,options:config,position:position};event.m(model).render();return{event:event,config:model};},close:function(event){var id=event.params().id;log.debug("close clicked for id %s",id);event.m({id:id}).render(function(){$(document).trigger("locshare-close");});return{event:event};},closeAll:function(event){log.debug("closing all");event.render();return{event:event};}});})(jQuery,LOCShare.Controllers);(function($,$C){var log,logModel,shareModel,pluginModel;$C.Share=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Controllers.Share");logModel=$.$("#logModel");shareModel=$.$("#shareModel");pluginModel=$.$("#pluginModel");};$.extend($C.Share.prototype,{handle:function(event){var id=$(event.target).parents("div").attr("id"),config=shareModel.get(id),position=$(event.target).position(),configHpos=config.position.horizontal,configVpos=config.position.vertical;if(("left"==configHpos)||("right"!=configHpos&&position.left+511>$(document).width())){position.left=position.left-450;}position.top+=18;log.debug("share clicked for id %s",id);$(document).trigger("locshare-open");logModel.post({root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,object_type:config.object_type,action:"view_save_share",target:null,title:config.title,link:config.link,embed_type:null,embed_detail:null,download_link_label:null});var model={id:id,options:config,position:position};event.m(model).render();return{event:event,config:model};},closeAll:function(event){log.debug("closing all");event.render();return{event:event};},addFavorite:function(event){var id=event.params("id"),config=shareModel.get(id);log.debug("addfavorite clicked");logModel.post({root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,object_type:config.object_type,action:"save_browser",target:null,title:config.title,link:config.link,embed_type:null,embed_detail:null,download_link_label:null});if(window.external){try{window.external.AddFavorite(config.link,config.title);}catch(e){alert("Press Command/CTRL-D to bookmark this page.");}}else{alert("Press Command/CTRL-D to bookmark this page.");}},showLink:function(event){var id=event.params("id"),config=shareModel.get(id);log.debug("show link clicked for id %s",id);logModel.post({root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,object_type:config.object_type,action:"link_view",target:null,title:config.title,link:config.link,embed_type:null,embed_detail:null,download_link_label:null});event.m({id:id,options:config,target:event.target}).v(".showLink").render();},showEmbed:function(event){var id=event.params("id"),config=shareModel.get(id);log.debug("show embed clicked for id %s",id);logModel.post({root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,object_type:config.object_type,action:"embed_view",target:null,title:config.title,link:config.link,embed_type:config.embed_type,embed_detail:config.embed_detail,download_link_label:null});event.m({id:id,options:config,target:event.target}).v(".showEmbed").render();},email:function(event){var id=event.params("id"),config=shareModel.get(id),emailModel=$.$("#emailModel"),resultSuccess=false,resultText="An Unknown Error Has Occurred";log.debug("email clicked");event.m({id:id,options:config}).v(".waitEmail").render();emailModel.validate({id:id,config:config,data:{root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,from_name:$("[name=from_name]",event.target).attr("value"),title:config.title,link:config.link,page_title:$("[name=page_title]",event.target).attr("value"),thumbnail:config.thumbnail},success:function(data){emailModel.send(data,function(status,result,code){log.debug("got e-mail response: %s, %s, %s",status,result,code);if(status=="success"){resultSuccess=true;logModel.post({root:config.root,app_id:config.app_id,request_type:config.request_type,request_datatype:config.request_datatype,object_type:config.object_type,action:"email",target:null,title:config.title,link:config.link,embed_type:null,embed_detail:null,download_link_label:null});}resultText=result;event.m({id:id,options:config,success:resultSuccess,code:code,text:resultText}).v(".updateEmailStatus").render();});},error:function(data,errors){log.debug("email validation failed.");event.m({id:id,options:config,errors:errors}).v(".showEmailErrors").render();}});},confirmEmail:function(event){var id=event.params("id");log.debug("email confirm clicked for id %s",id);event.m({id:id}).v(".confirmEmail").render();},close:function(event){var id=event.params("id");log.debug("close clicked for id %s",id);event.m({id:id}).render(function(){$(document).trigger("locshare-close");});return{event:event};}});})(jQuery,LOCShare.Controllers);(function($,$C){var log,logModel,shareModel,pluginModel;$C.Survey=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Controllers.Survey");logModel=$.$("#logModel");shareModel=$.$("#shareModel");pluginModel=$.$("#pluginModel");};$.extend($C.Survey.prototype,{handle:function(event){var id=$(event.target).parents("div").attr("id"),config=shareModel.get(id),position=$(event.target).position(),configHpos=config.position.horizontal,configVpos=config.position.vertical;if(("left"==configHpos)||("right"!=configHpos&&position.left+511>$(document).width())){position.left=position.left-450;}position.top+=18;log.debug("survey clicked for id %s",id);$(document).trigger("locshare-open");var model={id:id,options:config,position:position};event.m(model).render();return{event:event,config:model};},close:function(event){var id=event.params().id;log.debug("close clicked for id %s",id);event.m({id:id}).render(function(){$(document).trigger("locshare-close");});return{event:event};},closeAll:function(event){log.debug("closing all");event.render();return{event:event};}});})(jQuery,LOCShare.Controllers);(function($,$C){var log,pluginModel;$C.Print=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Controllers.Print");pluginModel=$.$("#pluginModel");};$.extend($C.Print.prototype,{print:function(event){window.print();return{event:event};}});})(jQuery,LOCShare.Controllers);(function($,$M){var plugins={};var points=["pre-setup","post-setup","pre-toolbar","post-toolbar","pre-print","post-print","pre-subscribe-open","post-subscribe-open","pre-subscribe-close","post-subscribe-close","pre-share-open","post-share-open","pre-share-close","post-share-close"];var enabled=false;$M.Plugin=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Models.Plugin");if(true===$.env("locshare")["allow_plugins"]){enabled=true;log.debug("The use of plugins is allowed.  Plugins are enabled.");}else{log.debug("The use of plugins is not allowed. Plugins are disabled.");}};$.extend($M.Plugin.prototype,{register:function(extPoint,name,plugin){if(true===enabled){var _this=this;if(true===$.isFunction(plugin)){if(-1<$.inArray(extPoint,points)){if(undefined==plugins[extPoint]){log.debug("Adding the first plugin for extension point '%s'",extPoint);plugins[extPoint]={};}plugins[extPoint][name]=plugin;log.debug("Registered a plugin named '%s' at extension point '%s'",name,extPoint);}else{log.warn("Plugin '%s' references an invalid extension point: '%s'.",name,extPoint);}}else{log.warn("Provided plugin '%s' for extension point '%s' is not a function.",name,extPoint);}}},unregister:function(extPoint,name){if(true===enabled){var _this=this;if(-1<$.inArray(extPoint,points)){if(undefined!=plugins[extPoint]){if(null!=name){if(undefined!=plugins[extPoint][name]){delete plugins[extPoint][name];log.debug("Plugin '%s' unregistered from the extension point '%s'",name,extPoint);}else{log.info("A plugin named '%s' does not exist at extension point '%s'",name,extPoint);}}else{delete plugins[extPoint];log.debug("All plugins for the extension point '%s' have been cleared",extPoint);}}else{log.warn("Extension point '%s' does not have any registered plugins",extPoint);}}else{log.warn("Extension point references for '%s' is invalid",extPoint);}}},list:function(){return plugins;},run:function(extPoint,data){if(true===enabled){if(undefined!=plugins[extPoint]){$.each(plugins[extPoint],function(name,plugin){if(true===$.isFunction(plugin)){log.debug("Running '%s' plugin at extension point '%s'",name,extPoint);plugin(data);log.debug("Finished running '%s' plugin at extension point '%s'",name,extPoint);}});}var triggerName="locshare-event-"+extPoint;log.debug("Firing trigger '%s'at extension point '%s'",triggerName,extPoint);$(document).trigger(triggerName,data);}}});})(jQuery,LOCShare.Models);(function($,$M){var log;$M.Log=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Models.Log");};$.extend($M.Log.prototype,{post:function(data){var _this=this;if(data.request_type==undefined){data.request_type="POST";}if(data.request_datatype==undefined){data.request_datatype="json";}log.debug("running log using root: %s",data.root);$.ajax({type:data.request_type,url:data.root+"log.php",dataType:data.request_datatype,data:{app_id:$.trim(data.app_id),object_type:$.trim(data.object_type),action:$.trim(data.action),target:$.trim(data.target),title:$.trim(data.title),link:$.trim(data.link),embed_type:$.trim(data.embed_type),embed_detail:$.trim(data.embed_detail),download_link_label:$.trim(data.download_link_label)},success:function(result){log.debug("Successfully posted log record.");}});}});})(jQuery,LOCShare.Models);(function($,$M){var log;$M.Email=function(options){$.extend(true,this,options);log=$.logger("LOCShare.Models.Log");};$.extend($M.Email.prototype,{validate:function(options){log.debug("Validating e-mail data...");var _this=this,field_defaults=$.env("locshare").field_defaults,baseError={field:null,message:null},isError=false,errors=[],success=null,error=null,maxCharacter=300,data=options.data;if(options.success&&$.isFunction(options.success)){success=options.success;}if(options.error&&$.isFunction(options.error)){error=options.error;}if(field_defaults.from_name==data.from_name||""==$.trim(data.from_name)){log.debug("From field not populated");isError=true;errors.push($.extend({},baseError,{field:"from_name",message:"Please fill in this required field."}));}log.debug("Validation finished with error status %s",isError);if(!isError&&null!=success){log.debug("Calling success callback...");success(data);}else{if(isError&&null!=error){log.debug("Calling error callback...");error(data,errors);}else{log.debug("No callback given...");}}},send:function(data,callback){var _this=this,field_defaults=$.env("locshare").field_defaults;var titleLength,diffLength,bodyMessage,pageTitle,emailSubject,messageLength,subject=" has shared a link from the Library of Congress",maxCharacter=$.env("locshare").body_max_characters,html,uri,sender_name;log.debug("Attempting to send email...");if(data.request_type==undefined){data.request_type="POST";}if(data.request_datatype==undefined){data.request_datatype="json";}if(field_defaults.from_name==data.from_name){data.from_name="";}else{data.from_name=$.trim(data.from_name);}pageTitle=data.page_title;titleLength=pageTitle.length;sender_name=data.from_name.replace(/[&\/\\#,+()$|~%.":*?<>{}!@^&*]/g,"").replace(/\s+/g," ");messageLength=parseInt(titleLength)+parseInt(sender_name.length)+parseInt(window.location.href.length)+parseInt(subject.length);if(messageLength>maxCharacter){diffLength=messageLength-parseInt(titleLength);pageTitle=pageTitle.substring(0,maxCharacter-diffLength)+" ...";}bodyMessage=pageTitle+"%0D%0A%0D%0A";bodyMessage+=encodeURIComponent(window.location.href)+"%0D%0A %0D%0A";emailSubject=sender_name;emailSubject+=subject;html=$(".locshare-email-tab-form-container").html();uri="mailto:?subject="+emailSubject+"&body="+bodyMessage;window.location.href=uri;$(".ui-dialog").hide();},_validateEmail:function(email){log.debug("Validating %s",email);var pattern=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern.test(email);}});})(jQuery,LOCShare.Models);(function($,$M){var log,cache,template=function(url,title,config){url=encodeURIComponent(url);title=encodeURIComponent(title);if(undefined===config){config={};}return[{name:"Facebook",url:"http://www.facebook.com/share.php?src=bm&u="+url+"&t="+title+"&v=3",icon:"icons/bm_facebook.gif"},{name:"Google+",url:"https://plus.google.com/share?url="+url+"",icon:"icons/google_plus.jpg"},{name:"Pinterest",url:"https://www.pinterest.com/pin/create/bookmarklet?url="+url+"&title="+title+"",icon:"icons/pinit_fg_en_round_red_16.png"},{name:"Tumblr",url:"http://www.tumblr.com/share/link?url="+url+"&name="+title+"",icon:"icons/tumblr.jpg"},{name:"Twitter",url:"http://twitter.com/home?status="+title+"%20-%20"+url+"",icon:"icons/bm_twitter.gif"},{name:"Reddit",url:"http://reddit.com/submit?url="+url+"&title="+title+"",icon:"icons/bm_reddit.gif"}];};$M.Share=function(){log=$.logger("LOCShare.Models.Share");cache={};};$.extend($M.Share.prototype,{get:function(id){if(!(id in cache)){this.put(id,"{}");}var config=$.env("locshare");$.$("#toolbarView").populateSurveyUrlByHref(config);config=$.extend(true,{},config,cache[id]);config=$.extend(true,config,{urls:template(config.link,config.title,config)});return config;},put:function(id,configString){var config;if(!(id in cache)){config=$.json2js(configString);if(""==config.title){config.title=config.link;}cache[id]=config;}}});})(jQuery,LOCShare.Models);(function($,$M){var log,cache;$M.Survey=function(){log=$.logger("LOCShare.Models.Survey");cache={};};$.extend($M.Survey.prototype,{get:function(data,callback){var _this=this;if(data.url==undefined&&data.fallback_url!=undefined){data.url=data.fallback_url;}if(!(data.id in cache)){_this.$log.debug("Page data not cached, sending request");_this.put(data,callback);}else{if(callback&&$.isFunction(callback)){callback(cache[data.id]);}}},put:function(data,callback){var _this=this;if(!(data.id in cache)){if(data.request_type==undefined||data.request_type=="POST"){data.request_type="GET";}if(data.survey_datatype==undefined){data.survey_datatype="html";}$.ajax({type:data.request_type,url:data.url,dataType:data.survey_datatype,success:function(result){_this.$log.debug("Successfully got survey content.");cache[data.id]=(result.content)?result.content:result;if(callback&&$.isFunction(callback)){callback(cache[data.id]);}},error:function(request,status,error){_this.$log.debug("Failed to get survey content.");cache[data.id]="An error occurred. Please try again later.";if(callback&&$.isFunction(callback)){callback(cache[data.id]);}}});}}});})(jQuery,LOCShare.Models);(function($,$M){var log,cache;$M.Subscribe=function(){log=$.logger("LOCShare.Models.Subscribe");cache={};};$.extend($M.Subscribe.prototype,{get:function(data,callback){var _this=this;if(data.url==undefined&&data.fallback_url!=undefined){data.url=data.fallback_url;}if(!(data.id in cache)){_this.$log.debug("Page data not cached, sending request");_this.put(data,callback);}else{if(callback&&$.isFunction(callback)){callback(cache[data.id]);}}},put:function(data,callback){var _this=this;if(!(data.id in cache)){if(data.request_type==undefined||data.request_type=="POST"){data.request_type="GET";}if(data.request_datatype==undefined){data.request_datatype="json";}$.ajax({type:data.request_type,url:data.url,dataType:data.request_datatype,success:function(result){_this.$log.debug("Successfully got subscribe content.");cache[data.id]=result.content;if(callback&&$.isFunction(callback)){callback(cache[data.id]);}},error:function(request,status,error){_this.$log.debug("Failed to get subscribe content.");cache[data.id]="An error occurred. Please try again later.";if(callback&&$.isFunction(callback)){callback(cache[data.id]);}}});}}});})(jQuery,LOCShare.Models);(function($){var log,logModel,shareModel,fieldDefaults,boostrapped,ready,start=new Date().getTime();$(document).bind("locshare-boot",function(){ready=new Date().getTime();if(window.Site&&window.Site.Plugins&&window.Site.Plugins.share){window.Site.Plugins.share($);}$.env();$.boot(function(){bootstrapped=new Date().getTime();log=log||$.logger("LOCShare");log.info("document ready %s",start-ready).info("app boot strapped %s",bootstrapped-ready);$("div.locshare-this").livequery(function(){$(this).hide();});$(document).trigger("locshare-ready");if(false!==$.env("locshare")["autoload"]){$(document).trigger("locshare-start");}});});$("div.locshare-share-tab-link-list > div > a").livequery("click",function(event){log=log||$.logger("LOCShare");logModel=logModel||$.$("#logModel");shareModel=shareModel||$.$("#shareModel");var id=$(event.target).attr("rel"),options=shareModel.get(id),target=$(event.target).text();log.debug("logging share %s:%s",target,options.link);logModel.post({root:options.root,app_id:options.app_id,request_type:options.request_type,request_datatype:options.request_datatype,object_type:options.object_type,action:"share",target:target,title:options.title,link:options.link,embed_type:null,embed_detail:null,download_link_label:null});});$("div.locshare-save-tab-downloads > div > div > p > a").livequery("click",function(event){log=log||$.logger("LOCShare");logModel=logModel||$.$("#logModel");shareModel=shareModel||$.$("#shareModel");var id=$(event.target).attr("rel"),options=shareModel.get(id),target=$(event.target).text(),link=$(event.target).attr("href");log.debug("logging share %s:%s",target,link);logModel.post({root:options.root,app_id:options.app_id,request_type:options.request_type,request_datatype:options.request_datatype,object_type:options.object_type,action:"download_file",target:null,title:options.title,link:link,embed_type:null,embed_detail:null,download_link_label:target});});$("textarea.locshare-email-tab-form-field-message").livequery("keyup",function(event){log=log||$.logger("LOCShare");var max=$.env("locshare").message_max_chars,current=$(event.target).attr("value").length,remaining=max-current;if(max<current){log.debug("string too long. trimming %s characters",(current-max));$(event.target).attr("value",$(event.target).attr("value").substring(0,max));}else{log.debug("field contains %s characters, %s remaining",current,remaining);$("span.locshare-email-tab-field-message-remaining-chars",$(event.target).parent("div.locshare-email-tab-input")).text(remaining);}return false;});$("textarea.locshare-email-tab-form-field-message").livequery("keypress",function(event){log=log||$.logger("LOCShare");if((!event.keyCode||(event.keyCode>46&&event.keyCode<90))&&$(event.target).attr("value").length>=$.env("locshare").message_max_chars){log.debug("preventing keypress");return false;}});$("input.locshare-email-tab-form-field-defaults").livequery("focus",function(event){log=log||$.logger("LOCShare");if(!fieldDefaults){fieldDefaults=$.env("locshare").field_defaults;}if($(event.target).attr("value")==fieldDefaults[$(event.target).attr("name")]){log.debug("clearing %s",$(event.target).attr("name"));$(event.target).attr("value","");}});$("input.locshare-email-tab-form-field-defaults").livequery("blur",function(event){log=log||$.logger("LOCShare");if(!fieldDefaults){fieldDefaults=$.env("locshare").field_defaults;}if($(event.target).attr("value")==""){log.debug("resetting %s",$(event.target).attr("name"));$(event.target).attr("value",fieldDefaults[$(event.target).attr("name")]);}});}(jQuery));